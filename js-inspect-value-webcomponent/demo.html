<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Inspect Value</title>
<script src="./InspectValue.js"></script>
<style>

inspect-value {
    /*display: block;*/
}

</style>
</head>
<body>
<inspect-value>Ololo Mememe</inspect-value>
<script type="text/javascript">

function add(...els) {
    const row = document.createElement('div');
    let first = true;
    for (const el of els) {
        if (!first) {
            row.appendChild(document.createTextNode(', '));
        }
        row.appendChild(el);
        first = false;
    }
    document.body.appendChild(row);
    return row;
}

function addValues(...values) {
    return add(...values.map((value) => InspectValue.create(value)));
}

const timeStart = new Date();
add(InspectValue.create(timeStart, 'timeStart'));
add(InspectValue.create(), InspectValue.create(null));
add(InspectValue.create(true), InspectValue.create(false));
addValues(0, 1234, NaN, 1/0);
addValues(13461347123582458n);
addValues("Ololo");
addValues(new Boolean(1), new Number(1234), Object(BigInt(1234)));
addValues(new String("Ololo"), new String(new Array(100).fill('long string').join(' ')));
addValues([0, 1, "Mememe", 1234n]);
addValues(new Array(100).fill('long string').join(' '));
addValues(new Set([1,2,3,4]));
var m = new Map();
m.set({}, 'obj1');
m.set([], 'arr');
m.set({}, 'obj2');
m.set(new Date(), 'date');
addValues(m);
addValues(document.body);
const iv = InspectValue.create(undefined, 'inspect self');
iv.value = iv;
add(iv);
addValues({
    null: null,
    boolTrue: true,
    boolFalse: false,
    num0: 0,
    num1234: 1234,
    bigint: 13461347123582458n,
    str: "Ololo",
    arr: [0, 1, "Mememe", 1234n],
    [Symbol('sym')]: 'Symbol is here',
    Boolean: new Boolean(false),
});
addValues([,,,,1234,5,6,7,8]);
const arr = [0,1,,3,,5];
arr.foo = 'bar';
arr[10] = 10;
arr.now = new Date();
addValues(arr);

addValues(new Date());
addValues(new Date(NaN));
addValues(window);
addValues(Symbol('sym'));

class Ololo {
    get ololo() {
        return 'mememe';
    }
}
add(InspectValue.create(new Ololo()));

const named = (param) => '1234' + param;
addValues(named);
addValues((param) => '5678' + param);
addValues(new Error(`Test error`));

try {
    1n / 0n;
}
catch (err) {
    addValues(err);
}

add(InspectValue.create(new InspectValue.Getter(() => {
    return new InspectValue.InfoText(`You've clicked it`);
}), 'inline getter'));

let recursiveGetterFunction = () => {
    const infoText = new InspectValue.InfoText(`Returning same getter as a result`);
    const valueWrapper = new InspectValue.ValueWrapper(infoText);
    setTimeout(() => {
        valueWrapper.set(recursiveGetterFunction);
    }, 2000);
    setTimeout(() => {
        valueWrapper.set(recursiveGetter);
    }, 4000);
    return valueWrapper;
};
let recursiveGetter = new InspectValue.Getter(recursiveGetterFunction);
addValues(InspectValue.create(recursiveGetterFunction));
add(InspectValue.create(recursiveGetter, 'recursive inline getter'));

let valueWrapper = new InspectValue.ValueWrapper(0);
addValues(valueWrapper);
valueWrapper._tmr = setInterval(() => { valueWrapper.set(valueWrapper.get() + 1) }, 1000);

(async () => {
    let asyncFunction = async (a) => {
        a = await a;
        await new Promise(resolve => setTimeout(resolve, 5000));
        if (isNaN(a)) {
            throw new Error(`Argument 'a' is NaN`);
        }
        return a + 1
    };
    addValues(asyncFunction);
    
    const prom0 = asyncFunction(0);
    addValues(prom0);
    
    const prom1 = asyncFunction(asyncFunction(0));
    addValues(prom1);
    const res1 = await prom1;
    addValues(res1);
    
    const prom2 = asyncFunction(NaN);
    addValues(prom2);
    try {
        // this would result in an error
        const res2 = await prom2;
        addValues(res2);
    }
    catch (err) {
        console.warn(`Expected error`, err);
    }
})();

const timeEnd = new Date();
add(InspectValue.create(timeEnd, 'timeEnd'), InspectValue.create(timeEnd - timeStart, 'renderDuration'));

const proxy = new Proxy({}, {
    get(target, key) {
        return target[key];
    },
    set(target, key, value) {
        return target[key] = value;
    },
});
proxy.a = 'a';
add(InspectValue.create(proxy), document.createTextNode('<-- middle click it to update view'));
proxy.b = 'b';

</script>
</body>
</html>